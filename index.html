<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶²é ç•«ç•«ç¨‹å¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¨­ç½®åŸºæœ¬å­—é«”å’ŒèƒŒæ™¯ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e5e7eb; /* æ·ºç°è‰²èƒŒæ™¯ */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px 10px;
        }

        .drawing-container {
            max-width: 900px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ç¹ªåœ–ç•«å¸ƒæ¨£å¼ */
        #drawing-canvas {
            background-color: white;
            border: 3px solid #3b82f6; /* è—è‰²é‚Šæ¡† */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            touch-action: none; /* ç¦ç”¨ç€è¦½å™¨é»˜èªçš„è§¸æ§æ“ä½œ */
            cursor: crosshair;
        }

        /* æ§åˆ¶é¢æ¿æ¨£å¼ */
        .controls {
            background-color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        /* é¡è‰²é¸æ“‡æŒ‰éˆ• */
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.1s;
        }

        .color-option.selected {
            border-color: #1f2937; /* æ·±è‰²é‚Šæ¡†è¡¨ç¤ºé¸ä¸­ */
            transform: scale(1.1);
        }

        /* ç²—ç´°é è¦½ */
        .size-preview {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #1f2937;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .size-dot {
            border-radius: 50%;
            background-color: white;
        }

        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 600px) {
            .controls {
                justify-content: space-around;
                padding: 0.75rem;
            }
            .color-option {
                width: 25px;
                height: 25px;
            }
        }
    </style>
</head>
<body>

<div class="drawing-container">
    <h1 class="text-3xl font-bold text-gray-800 mb-4">ğŸ¨ è‡ªç”±ç•«æ¿ ğŸ–Œï¸</h1>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="controls w-full">
        <!-- é¡è‰²é¸æ“‡ -->
        <div class="flex items-center space-x-2">
            <span class="text-gray-700 font-medium">é¡è‰²:</span>
            <div id="color-options" class="flex space-x-2">
                <!-- é¡è‰²æŒ‰éˆ•å°‡ç”± JS æ’å…¥ -->
            </div>
            <input type="color" id="custom-color" class="w-8 h-8 rounded-full border-none p-0 cursor-pointer" title="è‡ªå®šç¾©é¡è‰²">
        </div>

        <!-- ç²—ç´°é¸æ“‡ -->
        <div class="flex items-center space-x-3">
            <span class="text-gray-700 font-medium">ç²—ç´°:</span>
            <input type="range" id="brush-size" min="1" max="50" value="5" class="w-24">
            <div class="size-preview">
                <div id="size-dot" class="size-dot"></div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½æŒ‰éˆ• -->
        <button id="clear-btn" class="px-4 py-2 bg-red-500 text-white font-semibold rounded-md shadow-md hover:bg-red-600 transition">
            æ¸…é™¤ç•«å¸ƒ ğŸ—‘ï¸
        </button>
        <button id="save-btn" class="px-4 py-2 bg-green-500 text-white font-semibold rounded-md shadow-md hover:bg-green-600 transition">
            å„²å­˜åœ–ç‰‡ ğŸ’¾
        </button>
    </div>

    <!-- ç•«å¸ƒå€ -->
    <canvas id="drawing-canvas"></canvas>

</div>

<script>
    // ====================================================================
    // ç•«æ¿ç‹€æ…‹èˆ‡åˆå§‹åŒ–
    // ====================================================================

    const canvas = document.getElementById('drawing-canvas');
    const ctx = canvas.getContext('2d');
    
    const controls = {
        colorOptions: document.getElementById('color-options'),
        customColor: document.getElementById('custom-color'),
        brushSize: document.getElementById('brush-size'),
        sizeDot: document.getElementById('size-dot'),
        clearBtn: document.getElementById('clear-btn'),
        saveBtn: document.getElementById('save-btn'),
    };

    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    
    let currentColor = '#000000'; // é è¨­é¡è‰²
    let currentSize = 5;      // é è¨­ç²—ç´°

    // é è¨­é¡è‰²é¸é …
    const defaultColors = ['#000000', '#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'];

    /**
     * è¨­ç½®ç•«å¸ƒå°ºå¯¸ç‚ºå…¶çˆ¶å®¹å™¨çš„å¯¬åº¦å’Œé«˜åº¦ï¼Œä¸¦è™•ç†éŸ¿æ‡‰å¼ã€‚
     */
    function setCanvasSize() {
        // ç²å–å®¹å™¨çš„å¯¬åº¦
        const containerWidth = canvas.parentElement.clientWidth;
        
        // è¨­ç½®ç•«å¸ƒå°ºå¯¸ (ä¾‹å¦‚ 16:9 æ¯”ä¾‹)
        const width = Math.min(860, containerWidth - 20); // æœ€å¤§å¯¬åº¦ 860pxï¼Œé ç•™é‚Šè·
        const height = width * 0.7; // è¨­ç½®å¯¬é«˜æ¯”ä¾‹ç‚º 10:7

        // å„²å­˜ç•¶å‰ç•«å¸ƒå…§å®¹ (å¦‚æœéœ€è¦ä¿ç•™èˆŠåœ–)
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

        // è¨­ç½®ç•«å¸ƒçš„å¯¦éš›åƒç´ å°ºå¯¸
        canvas.width = width;
        canvas.height = height;

        // æ¢å¾©èˆŠåœ– (å¦‚æœéœ€è¦)
        ctx.putImageData(imageData, 0, 0);

        // é‡ç½®ç¹ªåœ–è¨­å®š
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentSize;
    }

    /**
     * æ›´æ–°ç•«ç­†é è¦½åœ“é»çš„å¤§å°å’Œé¡è‰²ã€‚
     */
    function updateSizePreview() {
        controls.sizeDot.style.width = `${currentSize}px`;
        controls.sizeDot.style.height = `${currentSize}px`;
        controls.sizeDot.style.backgroundColor = currentColor;
    }

    /**
     * ç¹ªåœ–åŠŸèƒ½æ ¸å¿ƒï¼šå¾ (x1, y1) ç•«ä¸€æ¢ç·šåˆ° (x2, y2)ã€‚
     * @param {number} x1 - èµ·å§‹ X åº§æ¨™
     * @param {number} y1 - èµ·å§‹ Y åº§æ¨™
     * @param {number} x2 - çµæŸ X åº§æ¨™
     * @param {number} y2 - çµæŸ Y åº§æ¨™
     */
    function draw(x1, y1, x2, y2) {
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }

    // ====================================================================
    // äº‹ä»¶è™•ç†å‡½æ•¸
    // ====================================================================

    /**
     * è™•ç†æ»‘é¼ /è§¸æ§é–‹å§‹äº‹ä»¶ã€‚
     */
    function startDrawing(e) {
        e.preventDefault(); // é˜²æ­¢è§¸æ§æ»¾å‹•ç­‰é»˜èªè¡Œç‚º
        isDrawing = true;
        
        // ç²å–æ­£ç¢ºçš„åº§æ¨™ (è™•ç†æ»‘é¼ å’Œè§¸æ§)
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        
        // è½‰æ›ç‚ºç›¸å°æ–¼ Canvas çš„åº§æ¨™
        const rect = canvas.getBoundingClientRect();
        [lastX, lastY] = [clientX - rect.left, clientY - rect.top];
        
        // ç¹ªè£½ä¸€å€‹é» (é¿å…é»æ“Šæ™‚æ²’æœ‰ç¹ªè£½)
        draw(lastX, lastY, lastX, lastY);
    }

    /**
     * è™•ç†æ»‘é¼ /è§¸æ§ç§»å‹•äº‹ä»¶ã€‚
     */
    function drawing(e) {
        if (!isDrawing) return;
        e.preventDefault();

        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;

        const rect = canvas.getBoundingClientRect();
        const newX = clientX - rect.left;
        const newY = clientY - rect.top;

        draw(lastX, lastY, newX, newY);
        [lastX, lastY] = [newX, newY]; // æ›´æ–° lastX, lastY
    }

    /**
     * è™•ç†æ»‘é¼ /è§¸æ§çµæŸäº‹ä»¶ã€‚
     */
    function stopDrawing() {
        isDrawing = false;
    }
    
    /**
     * è¨­ç½®æ–°çš„ç•«ç­†é¡è‰²ã€‚
     * @param {string} color - é¡è‰²çš„åå…­é€²ä½ç¢¼
     */
    function setBrushColor(color) {
        currentColor = color;
        ctx.strokeStyle = currentColor;
        
        // æ›´æ–°é¡è‰²é¸æ“‡ UI
        document.querySelectorAll('.color-option').forEach(el => {
            el.classList.remove('selected');
            if (el.style.backgroundColor.toLowerCase() === color.toLowerCase()) {
                el.classList.add('selected');
            }
        });
        controls.customColor.value = color;
        updateSizePreview();
    }

    /**
     * è™•ç†ç•«ç­†ç²—ç´°æ”¹è®Šã€‚
     */
    function handleSizeChange(e) {
        currentSize = parseInt(e.target.value);
        ctx.lineWidth = currentSize;
        updateSizePreview();
    }
    
    /**
     * æ¸²æŸ“é è¨­é¡è‰²æŒ‰éˆ•ã€‚
     */
    function renderColorOptions() {
        controls.colorOptions.innerHTML = '';
        defaultColors.forEach(color => {
            const button = document.createElement('div');
            button.className = 'color-option';
            button.style.backgroundColor = color;
            button.title = color;
            button.addEventListener('click', () => setBrushColor(color));
            
            if (color === currentColor) {
                button.classList.add('selected');
            }
            controls.colorOptions.appendChild(button);
        });
    }

    /**
     * è™•ç†å„²å­˜åœ–ç‰‡åŠŸèƒ½ã€‚
     */
    function handleSave() {
        // å°‡ Canvas å…§å®¹è½‰æ›ç‚ºåœ–ç‰‡ URL
        const imageURL = canvas.toDataURL('image/png'); 
        
        // å‰µå»ºä¸€å€‹è‡¨æ™‚é€£çµç”¨æ–¼ä¸‹è¼‰
        const a = document.createElement('a');
        a.href = imageURL;
        a.download = 'æˆ‘çš„ç•«ä½œ.png'; // è¨­ç½®ä¸‹è¼‰æª”å
        document.body.appendChild(a);
        a.click(); // æ¨¡æ“¬é»æ“Šä¸‹è¼‰
        document.body.removeChild(a);
    }


    // ====================================================================
    // è¨­ç½®ç›£è½å™¨èˆ‡å•Ÿå‹•
    // ====================================================================

    // æ»‘é¼ äº‹ä»¶
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', drawing);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    // è§¸æ§äº‹ä»¶ (é©ç”¨æ–¼æ‰‹æ©Ÿ/å¹³æ¿)
    canvas.addEventListener('touchstart', startDrawing);
    canvas.addEventListener('touchmove', drawing);
    canvas.addEventListener('touchend', stopDrawing);
    canvas.addEventListener('touchcancel', stopDrawing);

    // æ§åˆ¶é …äº‹ä»¶
    controls.brushSize.addEventListener('input', handleSizeChange);
    controls.customColor.addEventListener('input', (e) => setBrushColor(e.target.value));
    controls.clearBtn.addEventListener('click', () => {
        // æ¸…é™¤æ•´å€‹ç•«å¸ƒ (å¡«æ»¿ç™½è‰²)
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        setBrushColor(currentColor); // é‡æ–°è¨­ç½®é¡è‰²ï¼Œä»¥é˜²æ¸…é™¤å¾Œé¡è‰²æ”¹è®Š
    });
    controls.saveBtn.addEventListener('click', handleSave);
    
    // çª—å£å¤§å°æ”¹è®Šæ™‚èª¿æ•´ç•«å¸ƒ
    window.addEventListener('resize', () => {
        setCanvasSize();
        // æ¸…é™¤ç•«å¸ƒä¸¦é‡æ–°è¨­ç½®ç‚ºç™½è‰²
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    });


    // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
    window.onload = function() {
        setCanvasSize();
        // åˆå§‹è¨­å®šç•«å¸ƒç‚ºç™½è‰²èƒŒæ™¯
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        renderColorOptions();
        updateSizePreview();
        setBrushColor(currentColor); // ç¢ºä¿åˆå§‹é¡è‰²å’Œç²—ç´°æ‡‰ç”¨
    };

</script>

</body>
</html>